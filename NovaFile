project = "demo-lab"

[vm.ubuntu-dev]
image = "/var/lib/nova/images/ubuntu-22.04.qcow2"
cpu = 4
memory = "4Gi"
gpu_passthrough = false
network = "bridge0"
autostart = false

[vm.windows-test]
image = "/var/lib/nova/images/windows-11.qcow2"
cpu = 8
memory = "16Gi"
gpu_passthrough = true
network = "bridge0"
autostart = false

# High-performance container with Bolt
[container.web-api]
capsule = "ubuntu:22.04"
volumes = ["./api:/srv/api", "./data:/var/lib/data"]
network = "nova-net"
runtime = "bolt"
autostart = true

[container.web-api.env]
API_KEY = "development-key"
DATABASE_URL = "postgresql://user:pass@db:5432/mydb"

# Bolt-specific configuration
[container.web-api.bolt]
isolation = "strict"
security_profile = "production"
memory_limit = "2Gi"
cpu_limit = "2"

# Database with Docker fallback
[container.database]
capsule = "postgres:15"
volumes = ["./postgres-data:/var/lib/postgresql/data"]
network = "nova-net"
runtime = "docker"  # Explicit Docker usage
autostart = true

[container.database.env]
POSTGRES_DB = "mydb"
POSTGRES_USER = "user"
POSTGRES_PASSWORD = "pass"

# GPU workload with Bolt
[container.ml-training]
capsule = "pytorch/pytorch:latest-gpu"
runtime = "bolt"
network = "nova-net"

[container.ml-training.bolt]
gpu_access = true
gpu_devices = ["nvidia0"]
memory_limit = "8Gi"
isolation = "standard"
security_profile = "gpu"

[network.bridge0]
type = "bridge"
interfaces = ["enp6s0"]

[network.nova-net]
type = "overlay"
driver = "quic"
dns = true
subnet = "10.100.0.0/24"
gateway = "10.100.0.1"